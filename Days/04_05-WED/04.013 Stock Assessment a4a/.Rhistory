library(FLa4a)
library(diagram)
data(ple4)
data(ple4.indices)
source("funs.R")
plotS4("a4aFit", main="a4aFit class", lwd = 1, box.lwd = 2, cex.txt = 0.8, box.size = 0.1, box.type = "square", box.prop = 0.3)
plotS4("a4aFitSA", main="a4aFitSA class", lwd = 1, box.lwd = 2, cex.txt = 0.8, box.size = 0.1, box.type = "square", box.prop = 0.3)
plotS4("SCAPars", main="SCAPars class", lwd = 1, box.lwd = 2, cex.txt = 0.8, box.size = 0.1, box.type = "square", box.prop = 0.3)
plotS4("a4aStkParams", main="a4aStkParams class", lwd = 1, box.lwd = 2, cex.txt = 0.8, box.size = 0.1, box.type = "square", box.prop = 0.3)
plotS4("submodel", main="submodel class", lwd = 1, box.lwd = 2, cex.txt = 0.8, box.size = 0.1, box.type = "square", box.prop = 0.3)
fmodel <- ~ s(age, k=4) + s(year, k = 20)
qmodel <- list(~ s(age, k=4))
srmodel <- ~ factor(year)
fit <- sca(ple4, ple4.indices[1], fmodel=fmodel, qmodel=qmodel, srmodel=srmodel)
srmodel <- ~ s(year, k=20)
fit1 <- sca(ple4, ple4.indices[1], fmodel, qmodel, srmodel)
srmodel <- ~ ricker(CV=0.05)
fit2 <- sca(ple4, ple4.indices[1], fmodel, qmodel, srmodel)
srmodel <- ~ bevholt(CV=0.05)
fit3 <- sca(ple4, ple4.indices[1], fmodel, qmodel, srmodel)
srmodel <- ~ hockey(CV=0.05)
fit4 <- sca(ple4, ple4.indices[1], fmodel, qmodel, srmodel)
srmodel <- ~ geomean(CV=0.05)
fit5 <- sca(ple4, ple4.indices[1], fmodel, qmodel, srmodel)
flqs <- FLQuants(fac=stock.n(fit)[1], bh=stock.n(fit3)[1])
xyplot(data~year, groups=qname, data=flqs, type="l", main="Recruitment models", auto.key=list(points=FALSE, lines=TRUE, columns=3))
flqs <- FLQuants(fac=stock.n(fit)[1], bh=stock.n(fit4)[1])
xyplot(data~year, groups=qname, data=flqs, type="l", main="Recruitment models", auto.key=list(points=FALSE, lines=TRUE, columns=3))
flqs <- FLQuants(bh=stock.n(fit4)[1])
xyplot(data~year, groups=qname, data=flqs, type="l", main="Recruitment models", auto.key=list(points=FALSE, lines=TRUE, columns=3))
flqs <- FLQuants(bh=stock.n(fit1)[1])
xyplot(data~year, groups=qname, data=flqs, type="l", main="Recruitment models", auto.key=list(points=FALSE, lines=TRUE, columns=3))
flqs <- FLQuants(bh=stock.n(fit4)[1])
xyplot(data~year, groups=qname, data=flqs, type="l", main="Recruitment models", auto.key=list(points=FALSE, lines=TRUE, columns=3))
flqs <- FLQuants(bh=stock.n(fit5)[1])
xyplot(data~year, groups=qname, data=flqs, type="l", main="Recruitment models", auto.key=list(points=FALSE, lines=TRUE, columns=3))
srmodel <- ~ geomean(CV=0.01)
fit5 <- sca(ple4, ple4.indices[1], fmodel, qmodel, srmodel)
flqs <- FLQuants(bh=stock.n(fit5)[1])
xyplot(data~year, groups=qname, data=flqs, type="l", main="Recruitment models", auto.key=list(points=FALSE, lines=TRUE, columns=3))
srmodel <- ~ hockey(CV=0.01)
fit4 <- sca(ple4, ple4.indices[1], fmodel, qmodel, srmodel)
flqs <- FLQuants(bh=stock.n(fit4)[1])
xyplot(data~year, groups=qname, data=flqs, type="l", main="Recruitment models", auto.key=list(points=FALSE, lines=TRUE, columns=3))
srmodel <- ~ hockey(CV=0.001)
fit4 <- sca(ple4, ple4.indices[1], fmodel, qmodel, srmodel)
flqs <- FLQuants(bh=stock.n(fit4)[1])
xyplot(data~year, groups=qname, data=flqs, type="l", main="Recruitment models", auto.key=list(points=FALSE, lines=TRUE, columns=3))
# constant fishing mortality for ages older than 5
fmodel = ~ s(replace(age, age>5, 5), k=4) + s(year, k=20)
fit <- sca(ple4, ple4.indices, fmodel=fmodel)
wireframe(data ~ age + year, data = as.data.frame(harvest(fit)), drape = TRUE, screen = list(x = -90, y=-45))
# the same model with to two periods
fmodel=~s(age, k = 3, by = breakpts(year, 2000))
fit <- sca(ple4, ple4.indices, fmodel=fmodel)
wireframe(data ~ age + year, data = as.data.frame(harvest(fit)), drape = TRUE, screen = list(x = -90, y=-45))
# smoother for each age
fmodel <- ~ factor(age) + s(year, k=10, by = breakpts(age, c(2:8)))
fit <- sca(ple4, ple4.indices, fmodel=fmodel)
wireframe(data ~ age + year, data = as.data.frame(harvest(fit)), drape = TRUE, screen = list(x = -90, y=-45))
fmodel <- ~ s(age, k=4) + s(year, k = 20)
qmodel <- list( ~ s(age, k=4) + year)
srmodel <- ~s(year, k=20)
fit <- a4aSCA(ple4, ple4.indices[1], fmodel, qmodel, srmodel)
fit.pred <- predict(fit)
lapply(fit.pred, names)
fits <- simulate(fit, 1000)
flqs <- FLQuants(sim=iterMedians(stock.n(fits)), det=stock.n(fit))
xyplot(data~year|age, groups=qname, data=flqs, type="l", main="Median simulations VS fit", scales=list(y=list(relation="free")))
stks <- ple4 + fits
plot(stks)
fmodel <- ~year + year^2
fmodel <- ~year + year^2
fit <- sca(stock = ple4, indices = ple4.indices[1], fmodel=fmodel)
wireframe(data ~ age + year, data = as.data.frame(harvest(fit)), drape = TRUE, screen = list(x = -90, y=-45))
fmodel <- ~ (age + age^2)*year
fit <- sca(stock = ple4, indices = ple4.indices[1], fmodel=fmodel)
wireframe(data ~ age + year, data = as.data.frame(harvest(fit)), drape = TRUE, screen = list(x = -90, y=-45))
fmodel <- ~ (age + age^2)*year + age^3
fit <- sca(stock = ple4, indices = ple4.indices[1], fmodel=fmodel)
wireframe(data ~ age + year, data = as.data.frame(harvest(fit)), drape = TRUE, screen = list(x = -90, y=-45))
~ (age + age^2)*year + age^3
?formula
fmodel <- ~ age + age^2 + year
fit <- sca(stock = ple4, indices = ple4.indices[1], fmodel=fmodel)
wireframe(data ~ age + year, data = as.data.frame(harvest(fit)), drape = TRUE, screen = list(x = -90, y=-45))
fmodel <- ~ age + age^2
fit <- sca(stock = ple4, indices = ple4.indices[1], fmodel=fmodel)
wireframe(data ~ age + year, data = as.data.frame(harvest(fit)), drape = TRUE, screen = list(x = -90, y=-45))
fmodel <- ~ age + age^4
fit <- sca(stock = ple4, indices = ple4.indices[1], fmodel=fmodel)
wireframe(data ~ age + year, data = as.data.frame(harvest(fit)), drape = TRUE, screen = list(x = -90, y=-45))
fmodel <- ~ age + I(age^4)
fit <- sca(stock = ple4, indices = ple4.indices[1], fmodel=fmodel)
wireframe(data ~ age + year, data = as.data.frame(harvest(fit)), drape = TRUE, screen = list(x = -90, y=-45))
fmodel <- ~ age + I(age^2)
fit <- sca(stock = ple4, indices = ple4.indices[1], fmodel=fmodel)
wireframe(data ~ age + year, data = as.data.frame(harvest(fit)), drape = TRUE, screen = list(x = -90, y=-45))
fmodel <- ~ year*(age + I(age^2))
fit <- sca(stock = ple4, indices = ple4.indices[1], fmodel=fmodel)
wireframe(data ~ age + year, data = as.data.frame(harvest(fit)), drape = TRUE, screen = list(x = -90, y=-45))
fmodel <- ~ cos(year) + sen(year) + age
fit <- sca(stock = ple4, indices = ple4.indices[1], fmodel=fmodel)
fmodel <- ~ cos(year) + sin(year) + age
fit <- sca(stock = ple4, indices = ple4.indices[1], fmodel=fmodel)
wireframe(data ~ age + year, data = as.data.frame(harvest(fit)), drape = TRUE, screen = list(x = -90, y=-45))
fmodel <- ~ cos(pi*year) + sin(pi*year) + age
fit <- sca(stock = ple4, indices = ple4.indices[1], fmodel=fmodel)
wireframe(data ~ age + year, data = as.data.frame(harvest(fit)), drape = TRUE, screen = list(x = -90, y=-45))
fmodel <- ~ cos(0.1*pi*year) + sin(0.1*pi*year) + age
fit <- sca(stock = ple4, indices = ple4.indices[1], fmodel=fmodel)
wireframe(data ~ age + year, data = as.data.frame(harvest(fit)), drape = TRUE, screen = list(x = -90, y=-45))
nao <- read.table("http://www.cdc.noaa.gov/data/correlation/nao.data", skip=1, nrow=62, na.strings="-99.90")
dnms <- list(quant="nao", year=1948:2009, unit="unique", season=1:12, area="unique")
nao <- FLQuant(unlist(nao[,-1]), dimnames=dnms, units="nao")
nao <- seasonMeans(trim(nao, year=dimnames(stock.n(ple4))$year))
nao <- as.numeric(nao)
srmodel <- ~ nao
fit2 <- a4aSCA(ple4, ple4.indices[1], fmodel, qmodel, srmodel)
flqs <- FLQuants(fac=stock.n(fit)[1], cvar=stock.n(fit2)[1])
xyplot(data~year, groups=qname, data=flqs, type="l", main="Recruitment model with covariates")
keylst <- list(points=FALSE, lines=TRUE, space="right")
fit <- sca(ple4, ple4.indices)
# diagnostics
res <- residuals(fit, ple4, ple4.indices)
plot(res, main="Residuals")
bubbles(res)
qqmath(res)
# update stock object with assessment results
stk <- ple4 + fit
plot(stk, main="Stock summary")
# F 3D
wireframe(data ~ age + year, data = as.data.frame(harvest(stk)), drape = TRUE, main="Fishing mortality", screen = list(x = -90, y=-45))
# N 3D
wireframe(data ~ age + year, data = as.data.frame(stock.n(stk)), drape = TRUE, main="Population", screen = list(x = -90, y=-45))
# C 3D
wireframe(data ~ age + year, data = as.data.frame(catch.n(stk)), drape = TRUE, main="Catches")
qmodel <- list(~ factor(age))
fmodel <- ~ factor(age) + factor(year)
fit <- sca(stock = ple4, indices = ple4.indices[1], fmodel=fmodel, qmodel=qmodel)
wireframe(data ~ age + year, data = as.data.frame(harvest(fit)), drape = TRUE, screen = list(x = -90, y=-45))
# fix qmodel
qmodel <- list(~ factor(age))
# separable Fay = Fa * Fy
fmodel <- ~ factor(age) + factor(year)
fit <- sca(stock = ple4, indices = ple4.indices[1], fmodel=fmodel, qmodel=qmodel)
wireframe(data ~ age + year, data = as.data.frame(harvest(fit)), drape = TRUE, screen = list(x = -90, y=-45))
# smooth separable Fay = smooth Fa * smooth Fy
fmodel <- ~ s(age, k=4) + s(year, k = 20)
fit1 <- sca(ple4, ple4.indices[1], fmodel, qmodel)
wireframe(data ~ age + year, data = as.data.frame(harvest(fit1)), drape = TRUE, screen = list(x = -90, y=-45))
# interaction Fa * Fy
fmodel <- ~ te(age, year, k = c(4,20))
fit2 <- sca(ple4, ple4.indices[1], fmodel, qmodel)
wireframe(data ~ age + year, data = as.data.frame(harvest(fit2)), drape = TRUE, screen = list(x = -90, y=-45))
# smooth separable + interaction Fa,Fy
fmodel <- ~ s(age, k=4) + s(year, k = 20) + te(age, year, k = c(3,3))
fit3 <- sca(ple4, ple4.indices[1], fmodel, qmodel)
wireframe(data ~ age + year, data = as.data.frame(harvest(fit3)), drape = TRUE, screen = list(x = -90, y=-45))
# interaction Fa * Fy + recruitment F extra smooth
fmodel <- ~ te(age, year, k = c(4,20)) + s(year, k = 5, by = as.numeric(age==1))
fit4 <- sca(ple4, ple4.indices[1], fmodel, qmodel)
wireframe(data ~ age + year, data = as.data.frame(harvest(fit4)), drape = TRUE, screen = list(x = -90, y=-45))
# year fraction before the survey
sfrac <- mean(range(ple4.indices[[1]])[c("startf", "endf")])
# fix fmodel
fmodel <- ~ factor(age) + factor(year)
# one coefficient for each age
qmodel <- list(~ factor(age))
fit <- sca(ple4, ple4.indices[1], fmodel, qmodel)
# mambo jambo to plot index in the right period
Z <- (m(ple4) + harvest(fit))*sfrac # check M * sfrac
lst <- dimnames(fit@index[[1]])
lst$x <- stock.n(fit)*exp(-Z)
stkn <- do.call("trim", lst)
wireframe(data ~ age + year, data = as.data.frame(index(fit)[[1]]/stkn), drape = TRUE, screen = list(x = -90, y=-45))
# smooth age catchability
qmodel <- list(~ s(age, k=4))
fit1 <- sca(ple4, ple4.indices[1], fmodel, qmodel)
Z <- (m(ple4) + harvest(fit1))*sfrac
lst <- dimnames(fit1@index[[1]])
lst$x <- stock.n(fit1)*exp(-Z)
stkn <- do.call("trim", lst)
wireframe(data ~ age + year, data = as.data.frame(index(fit1)[[1]]/stkn), drape = TRUE, screen = list(x = -90, y=-45))
# age-year interaction
qmodel <- list(~ te(age, year, k = c(3,40)))
fit2 <- sca(ple4, ple4.indices[1], fmodel, qmodel)
Z <- (m(ple4) + harvest(fit2))*sfrac
lst <- dimnames(fit2@index[[1]])
lst$x <- stock.n(fit2)*exp(-Z)
stkn <- do.call("trim", lst)
wireframe(data ~ age + year, data = as.data.frame(index(fit2)[[1]]/stkn), drape = TRUE, screen = list(x = -90, y=-45))
# smooth age catchability + year linear effect
qmodel <- list( ~ s(age, k=4) + year)
fit3 <- sca(ple4, ple4.indices[1], fmodel, qmodel)
Z <- (m(ple4) + harvest(fit3))*sfrac
lst <- dimnames(fit3@index[[1]])
lst$x <- stock.n(fit3)*exp(-Z)
stkn <- do.call("trim", lst)
wireframe(data ~ age + year, data = as.data.frame(index(fit3)[[1]]/stkn), drape = TRUE, screen = list(x = -90, y=-45))
fmodel <- ~ s(age, k=4) + s(year, k = 20)
qmodel <- list(~ s(age, k=4))
srmodel <- ~ factor(year)
fit <- sca(ple4, ple4.indices[1], fmodel=fmodel, qmodel=qmodel, srmodel=srmodel)
srmodel <- ~ s(year, k=20)
fit1 <- sca(ple4, ple4.indices[1], fmodel, qmodel, srmodel)
srmodel <- ~ ricker(CV=0.05)
fit2 <- sca(ple4, ple4.indices[1], fmodel, qmodel, srmodel)
srmodel <- ~ bevholt(CV=0.05)
fit3 <- sca(ple4, ple4.indices[1], fmodel, qmodel, srmodel)
srmodel <- ~ hockey(CV=0.05)
fit4 <- sca(ple4, ple4.indices[1], fmodel, qmodel, srmodel)
srmodel <- ~ geomean(CV=0.05)
fit5 <- sca(ple4, ple4.indices[1], fmodel, qmodel, srmodel)
flqs <- FLQuants(fac=stock.n(fit)[1], bh=stock.n(fit4)[1])
flqs <- FLQuants(bh=stock.n(fit4)[1])
xyplot(data~year, groups=qname, data=flqs, type="l", main="Recruitment models", auto.key=keylst)
?s
fmodel <- ~ s(age, k=4) + s(year, k = 20)
qmodel <- list( ~ s(age, k=4) + year)
srmodel <- ~s(year, k=20)
fit <- a4aSCA(ple4, ple4.indices[1], fmodel, qmodel, srmodel)
fmodel <- ~ s(age, k=4) + s(year, k = 20)
qmodel <- list( ~ s(age, k=4) + year)
srmodel <- ~s(year, k=20)
fit <- a4aSCA(ple4, ple4.indices[1], fmodel, qmodel, srmodel)
srmodel <- ~ ricker(CV=0.05)
fit2 <- sca(ple4, ple4.indices[1], fmodel, qmodel, srmodel)
fmodel <- ~ s(age, k=4) + s(year, k = 20)
qmodel <- list(~ s(age, k=4))
srmodel <- ~ ricker(CV=0.05)
fit2 <- sca(ple4, ple4.indices[1], fmodel, qmodel, srmodel)
stk <- ple4 + sca(ple4, ple4.indices)
as.FLSR(ple4, model="ricker")
sr.fit <- fmle(as.FLSR(ple4, model="ricker"))
predict(sr.fit)
flqs <- FLQuants(fmle=predict(sr.fit), sca=rec(ple4 + fit2))
plot(flqs)
xyplot(data~year, groups=qname, data=flqs)
xyplot(data~year, groups=qname, data=flqs, auto.key=keylst)
xyplot(data~year, groups=qname, data=flqs, auto.key=keylst, type="l")
srmodel <- ~ ricker(CV=0.01)
fit2 <- sca(ple4, ple4.indices[1], fmodel, qmodel, srmodel)
flqs <- FLQuants(fmle=predict(sr.fit), sca=rec(ple4 + fit2))
xyplot(data~year, groups=qname, data=flqs, auto.key=keylst, type="l")
srmodel <- ~ ricker(CV=0.05)
fit2 <- sca(ple4, ple4.indices[1], fmodel, qmodel, srmodel)
flqs <- FLQuants(fmle=predict(sr.fit), sca=rec(ple4 + fit2))
xyplot(data~year, groups=qname, data=flqs, auto.key=keylst, type="l")
fit0 <- sca(ple4, ple4.indices[1])
fit1 <- a4aSCA(ple4, ple4.indices[1])
library(ggplotFL)
plot(FLStocks(sca=ple4 + fit0, a4aSCA=ple4+fit1))
fit1
fit0
fit0 <- sca(ple4, ple4.indices[1], fit="assessment")
fit1 <- a4aSCA(ple4, ple4.indices[1])
plot(FLStocks(sca=ple4 + fit0, a4aSCA=ple4+fit1))
fit0
fit1
n1model <- ~s(age, k=4)
fit1 <- a4aSCA(ple4, ple4.indices[1], fmodel, qmodel, srmodel, n1model)
flqs <- FLQuants(smo=stock.n(fit1), fac=stock.n(fit))
xyplot(data~age|year, groups=qname, data=flqs, type="l", main="N1 models", auto.key=keylst)
flqs <- FLQuants(smo=stock.n(fit1)[,1], fac=stock.n(fit)[,1])
xyplot(data~age, groups=qname, data=flqs, type="l", main="N1 models", auto.key=keylst)
vmodel <- list(~1, ~1)
fit <- a4aSCA(ple4, ple4.indices[1], fmodel, qmodel, srmodel, n1model, vmodel)
vmodel <- list(~ s(age, k=4), ~1)
fit1 <- a4aSCA(ple4, ple4.indices[1], fmodel, qmodel, srmodel, n1model, vmodel)
flqs <- FLQuants(cts=catch.n(fit), smo=catch.n(fit1))
xyplot(data~year|age, groups=qname, data=flqs, type="l", main="Variance models", scales=list(y=list(relation="free")), auto.key=keylst)
predict(fit)$vmodel$catch
wireframe(data ~ age + year, data = as.data.frame(predict(fit1)$vmodel$catch), drape = TRUE, screen = list(x = -90, y=-45))
vmodel <- list(~ s(age, k=5), ~1)
fit1 <- a4aSCA(ple4, ple4.indices[1], fmodel, qmodel, srmodel, n1model, vmodel)
flqs <- FLQuants(cts=catch.n(fit), smo=catch.n(fit1))
xyplot(data~year|age, groups=qname, data=flqs, type="l", main="Variance models", scales=list(y=list(relation="free")), auto.key=keylst)
predict(fit)$vmodel$catch
wireframe(data ~ age + year, data = as.data.frame(predict(fit1)$vmodel$catch), drape = TRUE, screen = list(x = -90, y=-45))
nao <- read.table("http://www.cdc.noaa.gov/data/correlation/nao.data", skip=1, nrow=62, na.strings="-99.90")
dnms <- list(quant="nao", year=1948:2009, unit="unique", season=1:12, area="unique")
nao <- FLQuant(unlist(nao[,-1]), dimnames=dnms, units="nao")
nao <- seasonMeans(trim(nao, year=dimnames(stock.n(ple4))$year))
nao <- as.numeric(nao)
srmodel <- ~ nao
fit2 <- a4aSCA(ple4, ple4.indices[1], fmodel, qmodel, srmodel)
flqs <- FLQuants(fac=stock.n(fit)[1], cvar=stock.n(fit2)[1])
xyplot(data~year, groups=qname, data=flqs, type="l", main="Recruitment model with covariates", auto.key=keylst)
srmodel <- ~ ricker(a=~nao, CV=0.1)
fit3 <- a4aSCA(ple4, ple4.indices[1], fmodel, qmodel, srmodel)
flqs <- FLQuants(fac=stock.n(fit)[1], cvar=stock.n(fit3)[1])
xyplot(data~year, groups=qname, data=flqs, type="l", main="Recruitment model with covariates", auto.key=keylst)
data(ple4)
data(ple4.indices)
stk <- ple4
idx <- ple4.indices[1]
# variance of observed catches
varslt <- catch.n(stk)
varslt[] <- 1
catch.n(stk) <- FLQuantDistr(catch.n(stk), varslt) # show: remove var
# variance of observed indices
varslt <- index(idx[[1]])
varslt[] <- 0.05
index.var(idx[[1]]) <- varslt
# run
fit <- a4aSCA(ple4, ple4.indices[1], vmodel=list(~1, ~1))
fit1 <- a4aSCA(stk, idx, vmodel=list(~1, ~1))
flqs <- FLQuants(nowgt=stock.n(fit), extwgt=stock.n(fit1))
xyplot(data~year|age, groups=qname, data=flqs, type="l", main="Likelihood weighting", scales=list(y=list(relation="free")), auto.key=keylst)
# constant fishing mortality for ages older than 5
fmodel = ~ s(replace(age, age>5, 5), k=4) + s(year, k=20)
fit <- sca(ple4, ple4.indices, fmodel=fmodel)
wireframe(data ~ age + year, data = as.data.frame(harvest(fit)), drape = TRUE, screen = list(x = -90, y=-45))
# the same model with to two periods
fmodel=~s(age, k = 3, by = breakpts(year, 2000))
fit <- sca(ple4, ple4.indices, fmodel=fmodel)
wireframe(data ~ age + year, data = as.data.frame(harvest(fit)), drape = TRUE, screen = list(x = -90, y=-45))
# smoother for each age
fmodel <- ~ factor(age) + s(year, k=10, by = breakpts(age, c(2:8)))
fit <- sca(ple4, ple4.indices, fmodel=fmodel)
wireframe(data ~ age + year, data = as.data.frame(harvest(fit)), drape = TRUE, screen = list(x = -90, y=-45))
fmodel <- ~ s(age, k=4) + s(year, k = 20)
qmodel <- list( ~ s(age, k=4) + year)
srmodel <- ~s(year, k=20)
fit <- a4aSCA(ple4, ple4.indices[1], fmodel, qmodel, srmodel)
#--------------------------------------------------------------------
# Predict
#--------------------------------------------------------------------
fit.pred <- predict(fit)
lapply(fit.pred, names)
#--------------------------------------------------------------------
# Simulate
#--------------------------------------------------------------------
fits <- simulate(fit, 1000)
flqs <- FLQuants(sim=iterMedians(stock.n(fits)), det=stock.n(fit))
xyplot(data~year|age, groups=qname, data=flqs, type="l", main="Median simulations VS fit", scales=list(y=list(relation="free")), auto.key=keylst)
stks <- ple4 + fits
plot(stks)
fits <- simulate(fit, 25)
stk <- ple4 + fits
fits2 <- a4aSCA(stk, ple4.indices[1], fmodel, qmodel, srmodel, fit="MP")
flqs <- FLQuants(fit=stock.n(fit), repl=iterMedians(stock.n(fits2)))
xyplot(data~year|age, groups=qname, data=flqs, type="l", scales=list(y=list(relation="free")), auto.key=keylst)
flqs <- FLQuants(fit=stock.n(fit), repl=stock.n(fits2))
xyplot(data~year|age, groups=qname, data=flqs, type="l", scales=list(y=list(relation="free")), auto.key=keylst)
plot(flqs)
plot(FLStocks(fit=stk, refit=stk+fits2))
plot(FLStocks(refit=stk+fits2, fit=stk))
rmod <- ~cos(year) + sin(year)
fit <- sca(ple4, ple4.indices, srmodel=rmod)
plot(ple4 + fit)
rmod <- ~cos(2*year) + sin(2*year)
fit <- sca(ple4, ple4.indices, srmodel=rmod)
plot(ple4 + fit)
rmod <- ~cos(0.2*year) + sin(0.2*year)
fit <- sca(ple4, ple4.indices, srmodel=rmod)
plot(ple4 + fit)
stk <- ple4 + sca(ple4, ple4.indices, srmodel="ricker")
stk <- ple4 + sca(ple4, ple4.indices, srmodel=~ricker())
sr.fit <- fmle(as.FLSR(ple4, model="ricker"))
flqs <- FLQuants(fmle=predict(sr.fit), sca=rec(ple4 + fit2))
xyplot(data~year, groups=qname, data=flqs, auto.key=keylst, type="l")
stk <- ple4 + sca(ple4, ple4.indices, srmodel=~ricker(CV=0.05))
sr.fit <- fmle(as.FLSR(ple4, model="ricker"))
flqs <- FLQuants(fmle=predict(sr.fit), sca=rec(ple4 + fit2))
xyplot(data~year, groups=qname, data=flqs, auto.key=keylst, type="l")
stk <- ple4 + sca(ple4, ple4.indices, srmodel=~ricker(CV=0.02))
sr.fit <- fmle(as.FLSR(ple4, model="ricker"))
flqs <- FLQuants(fmle=predict(sr.fit), sca=rec(ple4 + fit2))
xyplot(data~year, groups=qname, data=flqs, auto.key=keylst, type="l")
flqs <- FLQuants(fmle=predict(sr.fit), sca=rec(stk))
xyplot(data~year, groups=qname, data=flqs, auto.key=keylst, type="l")
stk <- ple4 + sca(ple4, ple4.indices, srmodel=~ricker(CV=0.05))
flqs <- FLQuants(fmle=predict(sr.fit), sca=rec(stk))
xyplot(data~year, groups=qname, data=flqs, auto.key=keylst, type="l")
stk <- ple4 + sca(ple4, ple4.indices, srmodel=~ricker(CV=0.1))
flqs <- FLQuants(fmle=predict(sr.fit), sca=rec(stk))
xyplot(data~year, groups=qname, data=flqs, auto.key=keylst, type="l")
stk <- ple4 + sca(ple4, ple4.indices, srmodel=~ricker(CV=0.05))
flqs <- FLQuants(fmle=predict(sr.fit), sca=rec(stk))
xyplot(data~year, groups=qname, data=flqs, auto.key=keylst, type="l")
plot(rec(stk)~ssb(stk))
plot(rec(sr.fit)~ssb(sr.fit))
plot(rec(stk)~ssb(stk))
plot(rec(sr.fit)~ssb(sr.fit))
plot(rec(stk)~ssb(stk))
plot(rec(sr.fit)~ssb(sr.fit))
